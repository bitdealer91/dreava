{"version":3,"file":"VirtualList-CkN222eY.js","sources":["../../src/components/VirtualList.jsx"],"sourcesContent":["import { useState, useEffect, useRef, useCallback, useMemo } from 'react';\n\nconst VirtualList = ({\n  items = [],\n  itemHeight = 200,\n  containerHeight = 600,\n  overscan = 5, // Количество элементов для предзагрузки\n  renderItem,\n  className = '',\n  onScroll = null,\n  keyExtractor = (item, index) => index,\n}) => {\n  const [scrollTop, setScrollTop] = useState(0);\n  const containerRef = useRef(null);\n  const scrollElementRef = useRef(null);\n\n  // Вычисляем видимые элементы\n  const visibleRange = useMemo(() => {\n    const startIndex = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);\n    const endIndex = Math.min(\n      items.length - 1,\n      Math.ceil((scrollTop + containerHeight) / itemHeight) + overscan\n    );\n    \n    return { startIndex, endIndex };\n  }, [scrollTop, containerHeight, itemHeight, overscan, items.length]);\n\n  // Получаем только видимые элементы\n  const visibleItems = useMemo(() => {\n    const { startIndex, endIndex } = visibleRange;\n    return items.slice(startIndex, endIndex + 1).map((item, index) => ({\n      item,\n      index: startIndex + index,\n      style: {\n        position: 'absolute',\n        top: (startIndex + index) * itemHeight,\n        height: itemHeight,\n        width: '100%',\n      },\n    }));\n  }, [items, visibleRange, itemHeight]);\n\n  // Обработчик скролла с throttling\n  const handleScroll = useCallback((event) => {\n    const newScrollTop = event.target.scrollTop;\n    setScrollTop(newScrollTop);\n    \n    if (onScroll) {\n      onScroll(newScrollTop);\n    }\n  }, [onScroll]);\n\n  // Оптимизированный скролл с requestAnimationFrame\n  const throttledScroll = useCallback((event) => {\n    if (!scrollElementRef.current) {\n      scrollElementRef.current = requestAnimationFrame(() => {\n        handleScroll(event);\n        scrollElementRef.current = null;\n      });\n    }\n  }, [handleScroll]);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (container) {\n      container.addEventListener('scroll', throttledScroll, { passive: true });\n      \n      return () => {\n        container.removeEventListener('scroll', throttledScroll);\n        if (scrollElementRef.current) {\n          cancelAnimationFrame(scrollElementRef.current);\n        }\n      };\n    }\n  }, [throttledScroll]);\n\n  // Общая высота контейнера\n  const totalHeight = items.length * itemHeight;\n\n  return (\n    <div\n      ref={containerRef}\n      className={`overflow-auto ${className}`}\n      style={{ height: containerHeight }}\n      onScroll={throttledScroll}\n    >\n      <div style={{ height: totalHeight, position: 'relative' }}>\n        {visibleItems.map(({ item, index, style }) => (\n          <div key={keyExtractor(item, index)} style={style}>\n            {renderItem(item, index)}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n// Оптимизированная версия для изображений\nexport const VirtualImageList = ({\n  images = [],\n  itemHeight = 200,\n  containerHeight = 600,\n  renderImage,\n  className = '',\n}) => {\n  const [loadedImages, setLoadedImages] = useState(new Set());\n  \n  const handleImageLoad = useCallback((index) => {\n    setLoadedImages(prev => new Set(prev).add(index));\n  }, []);\n\n  const renderItem = useCallback((image, index) => {\n    return (\n      <div className=\"relative\">\n        {renderImage(image, index, loadedImages.has(index))}\n        {!loadedImages.has(index) && (\n          <div \n            className=\"absolute inset-0 bg-zinc-800 animate-pulse\"\n            style={{ height: itemHeight }}\n          />\n        )}\n      </div>\n    );\n  }, [renderImage, loadedImages, itemHeight]);\n\n  return (\n    <VirtualList\n      items={images}\n      itemHeight={itemHeight}\n      containerHeight={containerHeight}\n      renderItem={renderItem}\n      className={className}\n      keyExtractor={(image, index) => `image-${index}-${image.src || image}`}\n    />\n  );\n};\n\nexport default VirtualList; "],"names":["VirtualList","items","itemHeight","containerHeight","overscan","renderItem","className","onScroll","keyExtractor","item","index","scrollTop","setScrollTop","useState","containerRef","useRef","scrollElementRef","visibleRange","useMemo","startIndex","endIndex","visibleItems","handleScroll","useCallback","event","newScrollTop","throttledScroll","useEffect","container","totalHeight","jsx","style","VirtualImageList","images","renderImage","loadedImages","setLoadedImages","prev","image","jsxs"],"mappings":"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"}