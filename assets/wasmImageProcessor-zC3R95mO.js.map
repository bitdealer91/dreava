{"version":3,"file":"wasmImageProcessor-zC3R95mO.js","sources":["../../src/utils/wasmImageProcessor.js"],"sourcesContent":["// wasmImageProcessor.js - WASM –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π\nexport class WasmImageProcessor {\n  constructor() {\n    this.wasmModule = null;\n    this.wasmLoaded = false;\n    this.canvasProcessor = null;\n    this.initCanvasProcessor();\n  }\n\n  async initCanvasProcessor() {\n    // –°–æ–∑–¥–∞–µ–º Canvas –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∫–∞–∫ fallback\n    this.canvasProcessor = new CanvasImageProcessor();\n    console.log('‚úÖ Canvas image processor initialized as fallback');\n  }\n\n  async loadWasm() {\n    try {\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ WASM —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ\n      const wasmPath = '/wasm/image-processor.wasm';\n      const response = await fetch(wasmPath, { method: 'HEAD' });\n      \n      if (response.ok) {\n        this.wasmModule = await WebAssembly.instantiateStreaming(\n          fetch(wasmPath)\n        );\n        this.wasmLoaded = true;\n        console.log('‚úÖ WASM image processor loaded successfully');\n      } else {\n        console.warn('‚ö†Ô∏è WASM file not found, using Canvas fallback');\n      }\n    } catch (error) {\n      console.warn('‚ö†Ô∏è WASM loading failed, using Canvas fallback:', error);\n    }\n  }\n\n  async optimize(file, quality = 0.8) {\n    if (this.wasmLoaded && this.wasmModule) {\n      try {\n        return await this.wasmOptimize(file, quality);\n      } catch (error) {\n        console.warn('‚ö†Ô∏è WASM optimization failed, falling back to Canvas');\n      }\n    }\n    \n    // Fallback –Ω–∞ Canvas –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é\n    return await this.canvasOptimize(file, quality);\n  }\n\n  async wasmOptimize(file, quality) {\n    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç WASM –ª–æ–≥–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n    // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º Canvas –∫–∞–∫ fallback\n    return await this.canvasOptimize(file, quality);\n  }\n\n  async canvasOptimize(file, quality) {\n    return new Promise((resolve) => {\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n      \n      img.onload = () => {\n        const maxWidth = 1200;\n        const maxHeight = 900;\n        \n        let { width, height } = img;\n        \n        if (width > maxWidth || height > maxHeight) {\n          const ratio = Math.min(maxWidth / width, maxHeight / height);\n          width *= ratio;\n          height *= ratio;\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ–º\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n        ctx.drawImage(img, 0, 0, width, height);\n        \n        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ blob —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º\n        canvas.toBlob((blob) => {\n          const optimizedFile = new File([blob], file.name, {\n            type: file.type,\n            lastModified: Date.now()\n          });\n          \n          console.log(`üì± Canvas optimization: ${file.size} -> ${optimizedFile.size} bytes`);\n          resolve(optimizedFile);\n        }, file.type, quality);\n      };\n      \n      img.onerror = () => {\n        console.warn('‚ö†Ô∏è Image loading failed, returning original file');\n        resolve(file);\n      };\n      \n      img.src = URL.createObjectURL(file);\n    });\n  }\n\n  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\n  async resizeImage(file, maxWidth, maxHeight) {\n    return await this.canvasOptimize(file, 1.0, { maxWidth, maxHeight });\n  }\n\n  async compressImage(file, quality) {\n    return await this.canvasOptimize(file, quality);\n  }\n\n  async convertFormat(file, format) {\n    return await this.canvasOptimize(file, 0.9, { format });\n  }\n}\n\n// Canvas –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∫–∞–∫ fallback\nclass CanvasImageProcessor {\n  constructor() {\n    this.supportedFormats = ['image/jpeg', 'image/png', 'image/webp'];\n  }\n\n  async optimize(file, quality = 0.8, options = {}) {\n    const { maxWidth, maxHeight, format } = options;\n    \n    return new Promise((resolve) => {\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      const img = new Image();\n      \n      img.onload = () => {\n        let { width, height } = img;\n        \n        // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞\n        if (maxWidth && width > maxWidth) {\n          const ratio = maxWidth / width;\n          width = maxWidth;\n          height *= ratio;\n        }\n        \n        if (maxHeight && height > maxHeight) {\n          const ratio = maxHeight / height;\n          height = maxHeight;\n          width *= ratio;\n        }\n        \n        canvas.width = width;\n        canvas.height = height;\n        \n        // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\n        ctx.imageSmoothingEnabled = true;\n        ctx.imageSmoothingQuality = 'high';\n        ctx.drawImage(img, 0, 0, width, height);\n        \n        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç\n        const outputFormat = format || file.type;\n        const mimeType = this.supportedFormats.includes(outputFormat) ? outputFormat : 'image/jpeg';\n        \n        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ blob\n        canvas.toBlob((blob) => {\n          const optimizedFile = new File([blob], file.name, {\n            type: mimeType,\n            lastModified: Date.now()\n          });\n          \n          console.log(`üì± Canvas optimization: ${file.size} -> ${optimizedFile.size} bytes (${Math.round((1 - optimizedFile.size / file.size) * 100)}% reduction)`);\n          resolve(optimizedFile);\n        }, mimeType, quality);\n      };\n      \n      img.onerror = () => {\n        console.warn('‚ö†Ô∏è Image loading failed, returning original file');\n        resolve(file);\n      };\n      \n      img.src = URL.createObjectURL(file);\n    });\n  }\n} "],"names":["WasmImageProcessor","CanvasImageProcessor","wasmPath","error","file","quality","resolve","canvas","ctx","img","width","height","ratio","blob","optimizedFile","maxWidth","maxHeight","format","options","outputFormat","mimeType"],"mappings":"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"}