class h{constructor(){this.worker=null,this.initialized=!1,this.bufferSize=1024*1024,this.init()}async init(){try{typeof SharedArrayBuffer<"u"?(this.worker=new Worker("/workers/shared-buffer-worker.js"),this.worker.onmessage=this.handleMessage.bind(this),this.worker.onerror=this.handleError.bind(this),this.initialized=!0,console.log("‚úÖ Shared Buffer Worker initialized")):console.warn("‚ö†Ô∏è SharedArrayBuffer not supported")}catch(e){console.warn("‚ö†Ô∏è Shared Buffer Worker initialization failed:",e)}}handleMessage(e){const{type:s,data:r,id:t}=e.data;switch(s){case"PROCESSING_COMPLETE":console.log("‚úÖ Shared buffer processing complete:",r);break;case"PROCESSING_PROGRESS":console.log("üìä Shared buffer progress:",r);break;case"ERROR":console.error("‚ùå Shared buffer error:",r);break;default:console.log("üì® Shared buffer message:",s,r)}}handleError(e){console.error("‚ùå Shared Buffer Worker error:",e)}async processFiles(e){return this.initialized?new Promise((s,r)=>{const t=Date.now(),c=setTimeout(()=>{console.error("‚è∞ Shared buffer processing timeout"),r(new Error("Processing timeout"))},3e4),a=i=>{const{type:o,data:l,id:d}=i.data;d===t&&(clearTimeout(c),this.worker.removeEventListener("message",a),o==="PROCESSING_COMPLETE"?s(l):o==="ERROR"&&r(new Error(l)))};this.worker.addEventListener("message",a);const n=e.map(i=>{const o=new SharedArrayBuffer(this.bufferSize);return{file:i,buffer:o}});this.worker.postMessage({type:"PROCESS_FILES",data:{files:n},id:t})}):(console.warn("‚ö†Ô∏è Shared Buffer Worker not available, using fallback"),await this.fallbackProcessing(e))}async fallbackProcessing(e){console.log("üîÑ Using fallback processing for files:",e.length);const s=[];for(const r of e)try{const t=await this.processFileFallback(r);s.push(t)}catch(t){console.error("‚ùå Fallback processing failed for file:",r.name,t),s.push({error:t.message})}return s}async processFileFallback(e){return new Promise(s=>{const r=new FileReader;r.onload=t=>{const c=t.target.result,a=new Uint8Array(c);let n=0;for(let i=0;i<a.length;i++)n+=a[i];s({file:e.name,size:e.size,checksum:n,processed:!0})},r.onerror=()=>{s({file:e.name,error:"File reading failed",processed:!1})},r.readAsArrayBuffer(e)})}async compressData(e){return this.initialized?new Promise((s,r)=>{const t=Date.now(),c=setTimeout(()=>{console.error("‚è∞ Compression timeout"),r(new Error("Compression timeout"))},1e4),a=n=>{const{type:i,data:o,id:l}=n.data;l===t&&(clearTimeout(c),this.worker.removeEventListener("message",a),i==="COMPRESSION_COMPLETE"?s(o):i==="ERROR"&&r(new Error(o)))};this.worker.addEventListener("message",a),this.worker.postMessage({type:"COMPRESS_DATA",data:{data:e},id:t})}):await this.fallbackCompression(e)}async fallbackCompression(e){try{const s=new CompressionStream("gzip"),r=s.writable.getWriter(),t=s.readable.getReader(),c=new Uint8Array(e);r.write(c),r.close();const a=[];for(;;){const{done:o,value:l}=await t.read();if(o)break;a.push(l)}const n=new Uint8Array(a.reduce((o,l)=>o+l.length,0));let i=0;for(const o of a)n.set(o,i),i+=o.length;return n.buffer}catch(s){return console.warn("‚ö†Ô∏è Fallback compression failed:",s),e}}async decompressData(e){return this.initialized?new Promise((s,r)=>{const t=Date.now(),c=setTimeout(()=>{console.error("‚è∞ Decompression timeout"),r(new Error("Decompression timeout"))},1e4),a=n=>{const{type:i,data:o,id:l}=n.data;l===t&&(clearTimeout(c),this.worker.removeEventListener("message",a),i==="DECOMPRESSION_COMPLETE"?s(o):i==="ERROR"&&r(new Error(o)))};this.worker.addEventListener("message",a),this.worker.postMessage({type:"DECOMPRESS_DATA",data:{data:e},id:t})}):await this.fallbackDecompression(e)}async fallbackDecompression(e){try{const s=new DecompressionStream("gzip"),r=s.writable.getWriter(),t=s.readable.getReader(),c=new Uint8Array(e);r.write(c),r.close();const a=[];for(;;){const{done:o,value:l}=await t.read();if(o)break;a.push(l)}const n=new Uint8Array(a.reduce((o,l)=>o+l.length,0));let i=0;for(const o of a)n.set(o,i),i+=o.length;return n.buffer}catch(s){return console.warn("‚ö†Ô∏è Fallback decompression failed:",s),e}}destroy(){this.worker&&(this.worker.terminate(),this.worker=null),this.initialized=!1}}export{h as SharedBufferWorker};
//# sourceMappingURL=sharedBufferWorker-CTA752j6-CWZKBTEP.js.map
