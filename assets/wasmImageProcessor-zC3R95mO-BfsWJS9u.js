class y{constructor(){this.wasmModule=null,this.wasmLoaded=!1,this.canvasProcessor=null,this.initCanvasProcessor()}async initCanvasProcessor(){this.canvasProcessor=new f,console.log("‚úÖ Canvas image processor initialized as fallback")}async loadWasm(){try{const e="/wasm/image-processor.wasm";(await fetch(e,{method:"HEAD"})).ok?(this.wasmModule=await WebAssembly.instantiateStreaming(fetch(e)),this.wasmLoaded=!0,console.log("‚úÖ WASM image processor loaded successfully")):console.warn("‚ö†Ô∏è WASM file not found, using Canvas fallback")}catch(e){console.warn("‚ö†Ô∏è WASM loading failed, using Canvas fallback:",e)}}async optimize(e,a=.8){if(this.wasmLoaded&&this.wasmModule)try{return await this.wasmOptimize(e,a)}catch{console.warn("‚ö†Ô∏è WASM optimization failed, falling back to Canvas")}return await this.canvasOptimize(e,a)}async wasmOptimize(e,a){return await this.canvasOptimize(e,a)}async canvasOptimize(e,a){return new Promise(m=>{const i=document.createElement("canvas"),s=i.getContext("2d"),c=new Image;c.onload=()=>{let{width:o,height:t}=c;if(o>1200||t>900){const n=Math.min(1200/o,900/t);o*=n,t*=n}i.width=o,i.height=t,s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(c,0,0,o,t),i.toBlob(n=>{const r=new File([n],e.name,{type:e.type,lastModified:Date.now()});console.log(`üì± Canvas optimization: ${e.size} -> ${r.size} bytes`),m(r)},e.type,a)},c.onerror=()=>{console.warn("‚ö†Ô∏è Image loading failed, returning original file"),m(e)},c.src=URL.createObjectURL(e)})}async resizeImage(e,a,m){return await this.canvasOptimize(e,1,{maxWidth:a,maxHeight:m})}async compressImage(e,a){return await this.canvasOptimize(e,a)}async convertFormat(e,a){return await this.canvasOptimize(e,.9,{format:a})}}class f{constructor(){this.supportedFormats=["image/jpeg","image/png","image/webp"]}async optimize(e,a=.8,m={}){const{maxWidth:i,maxHeight:s,format:c}=m;return new Promise(o=>{const t=document.createElement("canvas"),n=t.getContext("2d"),r=new Image;r.onload=()=>{let{width:l,height:g}=r;if(i&&l>i){const d=i/l;l=i,g*=d}if(s&&g>s){const d=s/g;g=s,l*=d}t.width=l,t.height=g,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(r,0,0,l,g);const w=c||e.type,u=this.supportedFormats.includes(w)?w:"image/jpeg";t.toBlob(d=>{const h=new File([d],e.name,{type:u,lastModified:Date.now()});console.log(`üì± Canvas optimization: ${e.size} -> ${h.size} bytes (${Math.round((1-h.size/e.size)*100)}% reduction)`),o(h)},u,a)},r.onerror=()=>{console.warn("‚ö†Ô∏è Image loading failed, returning original file"),o(e)},r.src=URL.createObjectURL(e)})}}export{y as WasmImageProcessor};
//# sourceMappingURL=wasmImageProcessor-zC3R95mO-BfsWJS9u.js.map
